<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cancionero Web</title>
<style>
body { font-family: 'Arial', sans-serif; text-align:center; background:#f5f5f5; margin:0; padding-bottom:50px; }
h1 { color:#2c3e50; margin:20px; font-size:2rem; }
#buscador { margin:10px auto; padding:10px; width:90%; max-width:500px; font-size:16px; border-radius:8px; border:1px solid #ccc; }
.cancion { background:white; margin:10px auto; padding:15px; border-radius:10px; width:90%; max-width:500px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.15); transition:0.3s; }
.cancion:hover { background:#eaf4ff; transform: translateY(-2px);}
.titulo { font-size:1.2rem; font-weight:bold; color:#2980b9; }
.letra { white-space: pre-wrap; font-weight:bold; font-size:1.1rem; line-height:1.6; text-align:center; margin-top:20px; }
#detalle, #repertorio { display:none; padding:20px; }
button { margin-top:10px; padding:10px 20px; border:none; border-radius:10px; cursor:pointer; background:#2980b9; color:white; transition:0.3s;}
button:hover { background:#1a5f91; }
#repertorioLista, #lista { margin-top:15px; text-align:left; max-width:90%; margin-left:auto; margin-right:auto;}
.notificacion { background:#27ae60; color:white; padding:10px; border-radius:8px; margin:10px auto; width:90%; max-width:400px; display:none; box-shadow:0 3px 6px rgba(0,0,0,0.1);}
input, select { padding:8px 10px; border-radius:6px; border:1px solid #ccc; margin:5px;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>ðŸ“– Cancionero</h1>
<div class="notificacion" id="notificacion"></div>

<div id="pantallaPrincipal" style="display:block;">
    <button id="btnCrearRepertorio">Crear Repertorio</button>
    <button id="btnVerRepertorios">Ver Repertorios</button>
    <input type="text" id="buscador" placeholder="ðŸ”Ž Buscar canciÃ³n...">
    <div id="lista"></div>
</div>

<div id="detalle">
  <h2 id="tituloCancion"></h2>
  <div id="letraCancion" class="letra"></div>
  <div id="tutoriales">
    <button class="tutorialBtn" data-instrumento="teclado">Teclado</button>
    <button class="tutorialBtn" data-instrumento="bateria">BaterÃ­a</button>
    <button class="tutorialBtn" data-instrumento="guitarra">Guitarra</button>
    <button class="tutorialBtn" data-instrumento="audio">Reproducir CanciÃ³n</button>
  </div>
  <button id="volver">â¬… Volver</button>
</div>

<div id="repertorio">
  <h2>Mis Repertorios</h2>
  <div>
    <input type="text" id="nuevoRepertorio" placeholder="Nombre del nuevo repertorio">
    <button id="crearRepertorio">Crear</button>
  </div>
  <label for="selectMisRepertorios">Seleccionar Repertorio:</label>
  <select id="selectMisRepertorios"></select>
  <div id="repertorioLista"></div>
  <button id="volverRepertorio">â¬… Volver</button>
</div>

<div id="modal" class="modal" style="display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.7);">
    <div style="background-color:#fefefe; margin:10% auto; padding:0; border-radius:10px; width:90%; max-width:800px; position:relative;">
        <span id="cerrarModal" style="color:white; position:absolute; top:10px; right:20px; font-size:30px; font-weight:bold; cursor:pointer;">&times;</span>
        <iframe id="iframeModal" allow="autoplay; encrypted-media" allowfullscreen style="width:100%; height:400px; border:none; border-radius:10px 10px 0 0;"></iframe>
    </div>
</div>

<script>
let canciones=[], listaFiltrada=[];
let repertorios = JSON.parse(localStorage.getItem("repertorios")) || {};
let repertorioActual = null;

const URL_JSON = "https://cdn.jsdelivr.net/gh/walterrubenhg/ESCOGIDOS/canciones.json?nocache=" + Date.now();
const pantallaPrincipal = document.getElementById("pantallaPrincipal");
const listaDiv = document.getElementById("lista");
const detalleDiv = document.getElementById("detalle");
const repertorioDiv = document.getElementById("repertorio");

// --- Funciones ---
function mostrarNotificacion(msg){
    const n = document.getElementById("notificacion");
    n.textContent = msg; n.style.display="block";
    setTimeout(()=>n.style.display="none",3000);
}

function guardarRepertorios(){ 
    localStorage.setItem("repertorios",JSON.stringify(repertorios)); 
    actualizarSelectMisRepertorios(); 
}

function actualizarLista(){
    const texto=document.getElementById("buscador").value.toLowerCase();
    listaFiltrada = canciones.filter(c=>c.titulo.toLowerCase().includes(texto) || c.letra.toLowerCase().includes(texto));
    listaDiv.innerHTML="";
    listaFiltrada.forEach(c=>{
        const div = document.createElement("div");
        div.className="cancion"; div.textContent=c.titulo;
        div.onclick=()=>mostrarDetalle(c);
        listaDiv.appendChild(div);
    });
}

// --- Detalle canciÃ³n ---
function mostrarDetalle(c){
    pantallaPrincipal.style.display="none"; detalleDiv.style.display="block";
    document.getElementById("tituloCancion").textContent=c.titulo;
    document.getElementById("letraCancion").textContent=c.letra;

    document.querySelectorAll(".tutorialBtn").forEach(btn=>{
        btn.onclick=()=>{
            const instr = btn.dataset.instrumento;
            let url = "";
            if(instr==="teclado") url=c.tutorial?.teclado||"";
            else if(instr==="bateria") url=c.tutorial?.bateria||"";
            else if(instr==="guitarra") url=c.tutorial?.guitarra||"";
            else if(instr==="audio") url=c.audio||"";
            if(url){ document.getElementById("iframeModal").src=url; document.getElementById("modal").style.display="block";}
        };
    });
}

// --- Modal ---
document.getElementById("cerrarModal").onclick=()=>{
    document.getElementById("iframeModal").src="";
    document.getElementById("modal").style.display="none";
};

// --- Volver ---
document.getElementById("volver").onclick=()=>{
    detalleDiv.style.display="none"; pantallaPrincipal.style.display="block";
    actualizarLista();
};

document.getElementById("volverRepertorio").onclick = ()=>{
    repertorioDiv.style.display="none"; pantallaPrincipal.style.display="block";
    actualizarLista();
};

// --- Cargar canciones ---
fetch(URL_JSON)
.then(res=>res.json())
.then(data=>{ canciones=data.canciones||[]; actualizarLista(); })
.catch(()=>{ canciones=[]; actualizarLista(); });

// --- Repertorios ---
function actualizarSelectMisRepertorios(){
    const select = document.getElementById("selectMisRepertorios");
    select.innerHTML="";
    for(let r in repertorios){
        const opt=document.createElement("option"); opt.value=r; opt.textContent=r; select.appendChild(opt);
    }
    repertorioActual = select.value || null;
    mostrarRepertorio();
    select.onchange=()=>{ repertorioActual=select.value; mostrarRepertorio(); };
}

function mostrarRepertorio(){
    listaDiv.innerHTML=""; pantallaPrincipal.style.display="none"; detalleDiv.style.display="none"; repertorioDiv.style.display="block";
    const cont=document.getElementById("repertorioLista"); cont.innerHTML="";
    if(!repertorioActual) { cont.innerHTML="Selecciona un repertorio"; return;}
    repertorios[repertorioActual].forEach((titulo,i)=>{
        const div=document.createElement("div"); div.className="cancion"; div.textContent=titulo;
        div.onclick=()=>{
            const c = canciones.find(x=>x.titulo===titulo);
            if(c) mostrarDetalle(c);
        };
        cont.appendChild(div);
    });
}

// --- Crear repertorio ---
document.getElementById("crearRepertorio").onclick=()=>{
    const nombre=document.getElementById("nuevoRepertorio").value.trim();
    if(!nombre) return mostrarNotificacion("Escribe un nombre de repertorio");
    if(repertorios[nombre]) return mostrarNotificacion("Ese repertorio ya existe");
    repertorios[nombre]=[]; guardarRepertorios(); document.getElementById("nuevoRepertorio").value="";
    mostrarNotificacion(`Repertorio "${nombre}" creado`);
};

// --- Botones principales ---
document.getElementById("btnCrearRepertorio").onclick=()=>{ repertorioDiv.style.display="block"; pantallaPrincipal.style.display="none"; };
document.getElementById("btnVerRepertorios").onclick=()=>{
    actualizarSelectMisRepertorios(); repertorioDiv.style.display="block"; pantallaPrincipal.style.display="none";
};

document.getElementById("buscador").addEventListener("input", actualizarLista);
</script>
</body>
</html>

