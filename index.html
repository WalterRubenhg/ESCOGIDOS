<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cancionero Web</title>
<style>
body {
    font-family: 'Arial', sans-serif;
    background: #000;
    color: #f5f5f5;
    margin: 0;
    padding: 0;
    text-align: center;
}
h1 { color: #ffa500; margin: 20px; }
button, select, input { cursor: pointer; border-radius: 8px; border: none; font-size: 1rem; }
#buscador { width: 90%; max-width: 500px; padding: 10px; margin: 10px auto; font-size: 16px; }
.cancion { background: #111; margin: 10px auto; padding: 10px; width: 90%; max-width: 500px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
.cancion:hover { background: #222; transform: translateY(-2px); }
.titulo { font-weight: bold; color: #ffa500; flex: 1; text-align: left; cursor: pointer; }
.letra { white-space: pre-wrap; font-weight: bold; font-size: 1.1rem; line-height: 1.6; margin: 20px; text-align: center; }
#detalle, #repertorio { display: none; padding: 20px; }
button { background: #ffa500; color: #000; padding: 8px 15px; margin: 5px; transition: 0.2s; }
button:hover { background: #ffbf00; }
.selectRepertorio, #nuevoRepertorio { padding: 5px; margin: 5px; }
#notificacion { display: none; padding: 10px; background: #ffbf00; color: #000; border-radius: 8px; margin: 10px auto; max-width: 400px; }
.modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 1000; }
.modal-content { margin: 10% auto; background: #000; width: 90%; max-width: 800px; border-radius: 10px; position: relative; padding: 0; }
.modal iframe { width: 100%; height: 400px; border-radius: 10px 10px 0 0; border: none; }
.closeModal { position: absolute; top: 10px; right: 20px; font-size: 30px; color: #ffa500; cursor: pointer; }
.closeModal:hover { color: #ffbf00; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>📖 Cancionero Web</h1>
<div id="notificacion"></div>

<div id="pantallaPrincipal">
    <input type="text" id="buscador" placeholder="🔎 Buscar canción...">
    <div id="lista"></div>

    <div>
        <button id="btnCrearRepertorio">➕ Crear Repertorio</button>
        <button id="btnVerRepertorios">📂 Ver Mis Repertorios</button>
    </div>
</div>

<div id="detalle">
    <h2 id="tituloCancion"></h2>
    <div>
        <button class="tutorialBtn" data-instrumento="teclado">Teclado</button>
        <button class="tutorialBtn" data-instrumento="bateria">Batería</button>
        <button class="tutorialBtn" data-instrumento="guitarra">Guitarra</button>
        <button class="tutorialBtn" data-instrumento="audio">Reproducir Canción</button>
    </div>
    <div id="letraCancion" class="letra"></div>
    <button id="volver">⬅ Volver</button>
</div>

<div id="repertorio">
    <h2>Repertorios</h2>
    <input type="text" id="nuevoRepertorio" placeholder="Nombre del nuevo repertorio">
    <button id="crearRepertorio">Crear</button>
    <select id="selectMisRepertorios" class="selectRepertorio"></select>
    <div id="repertorioLista"></div>
    <button id="volverRepertorio">⬅ Volver</button>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="closeModal" id="cerrarModal">&times;</span>
        <iframe id="iframeModal" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<script>
let canciones = [];
let repertorios = JSON.parse(localStorage.getItem("repertorios")) || {};
let repertorioActual = null;
let origenDetalle = "principal";

const URL_JSON = "https://cdn.jsdelivr.net/gh/walterrubenhg/ESCOGIDOS/canciones.json";

function mostrarNotificacion(msg){
    const n = document.getElementById("notificacion");
    n.textContent = msg; n.style.display="block";
    setTimeout(()=> n.style.display="none",3000);
}

fetch(URL_JSON)
.then(res=>res.json())
.then(data=>{ if(data && data.canciones) canciones=data.canciones; actualizarLista(); })
.catch(()=>{ canciones=[]; actualizarLista(); });

function actualizarLista(){
    const texto = document.getElementById("buscador").value.toLowerCase();
    const listaDiv = document.getElementById("lista"); listaDiv.innerHTML="";
    canciones.filter(c=>c.titulo.toLowerCase().includes(texto) || c.letra.toLowerCase().includes(texto))
    .forEach(c=>{
        const div = document.createElement("div"); div.className="cancion";

        const span = document.createElement("span"); span.textContent=c.titulo; span.className="titulo";
        span.onclick = ()=> mostrarDetalle(c, "principal");
        div.appendChild(span);

        const selectRep = document.createElement("select");
        const defaultOpt = document.createElement("option"); defaultOpt.value=""; defaultOpt.textContent="+ Repertorio";
        selectRep.appendChild(defaultOpt);
        for(let r in repertorios){
            const opt = document.createElement("option"); opt.value=r; opt.textContent=r; selectRep.appendChild(opt);
        }
        selectRep.onchange = ()=>{
            const r = selectRep.value; if(!r) return;
            if(!repertorios[r]) repertorios[r]=[];
            if(!repertorios[r].includes(c.titulo)) repertorios[r].push(c.titulo);
            localStorage.setItem("repertorios", JSON.stringify(repertorios));
            mostrarNotificacion(`"${c.titulo}" agregado a "${r}"`); selectRep.value="";
        };
        div.appendChild(selectRep);

        listaDiv.appendChild(div);
    });
}

function mostrarDetalle(c, origen){
    if(!c) return;
    origenDetalle = origen || "principal";
    document.getElementById("detalle").style.display="block";
    document.getElementById("pantallaPrincipal").style.display="none";
    document.getElementById("repertorio").style.display="none";

    document.getElementById("tituloCancion").textContent = c.titulo;
    document.getElementById("letraCancion").textContent = c.letra || "No hay letra disponible.";

    const iframe=document.getElementById("iframeModal");
    const modal=document.getElementById("modal");
    document.querySelectorAll(".tutorialBtn").forEach(btn=>{
        const instr=btn.dataset.instrumento;
        btn.onclick = ()=>{
            const url = (instr==="audio")?c.audio:(c.tutorial?.[instr]||"");
            if(!url) return mostrarNotificacion("No hay tutorial/audio disponible");
            iframe.src=url; modal.style.display="block";
        };
    });
}

document.getElementById("cerrarModal").onclick = ()=>{ document.getElementById("iframeModal").src=""; document.getElementById("modal").style.display="none"; };
document.getElementById("volver").onclick = ()=>{
    document.getElementById("detalle").style.display="none";
    if(origenDetalle==="repertorio") mostrarRepertorio();
    else document.getElementById("pantallaPrincipal").style.display="block";
};

function actualizarSelectMisRepertorios(){
    const sel=document.getElementById("selectMisRepertorios"); sel.innerHTML="";
    for(let r in repertorios){
        const opt=document.createElement("option"); opt.value=r; opt.textContent=r; sel.appendChild(opt);
    }
}
function mostrarRepertorio(){
    if(!repertorioActual) return;
    document.getElementById("repertorio").style.display="block";
    document.getElementById("pantallaPrincipal").style.display="none";

    document.getElementById("selectMisRepertorios").value = repertorioActual;
    const repListaDiv = document.getElementById("repertorioLista"); repListaDiv.innerHTML="";
    repertorios[repertorioActual].forEach(titulo=>{
        const c = canciones.find(x=>x.titulo===titulo); if(!c) return;
        const div=document.createElement("div"); div.className="cancion";
        const span=document.createElement("span"); span.textContent=c.titulo; span.className="titulo";
        span.onclick = ()=> mostrarDetalle(c, "repertorio"); div.appendChild(span);
        const btnEliminar=document.createElement("button"); btnEliminar.textContent="❌"; btnEliminar.className="eliminarCancion";
        btnEliminar.onclick=()=>{
            repertorios[repertorioActual]=repertorios[repertorioActual].filter(x=>x!==c.titulo);
            localStorage.setItem("repertorios", JSON.stringify(repertorios)); mostrarRepertorio();
        };
        div.appendChild(btnEliminar);
        repListaDiv.appendChild(div);
    });
}

document.getElementById("btnCrearRepertorio").onclick=()=>{
    document.getElementById("pantallaPrincipal").style.display="none";
    document.getElementById("repertorio").style.display="block";
};
document.getElementById("crearRepertorio").onclick=()=>{
    const nombre=document.getElementById("nuevoRepertorio").value.trim();
    if(!nombre) return mostrarNotificacion("Escribe un nombre"); 
    if(repertorios[nombre]) return mostrarNotificacion("Ya existe");
    repertorios[nombre]=[]; localStorage.setItem("repertorios", JSON.stringify(repertorios));
    actualizarSelectMisRepertorios(); mostrarNotificacion(`Repertorio "${nombre}" creado`); document.getElementById("nuevoRepertorio").value="";
};
document.getElementById("btnVerRepertorios").onclick=()=>{
    repertorioActual = Object.keys(repertorios)[0] || null; mostrarRepertorio();
};
document.getElementById("selectMisRepertorios").onchange=()=>{
    repertorioActual=document.getElementById("selectMisRepertorios").value; mostrarRepertorio();
};
document.getElementById("volverRepertorio").onclick=()=>{
    document.getElementById("repertorio").style.display="none";
    document.getElementById("pantallaPrincipal").style.display="block";
};

document.getElementById("buscador").addEventListener("input", actualizarLista);
actualizarSelectMisRepertorios();
</script>

</body>
</html>



