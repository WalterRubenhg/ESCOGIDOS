<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cancionero Web</title>
<style>
/* --- ESTILOS GENERALES --- */
body {
    font-family: 'Arial', sans-serif;
    background: #000;
    color: #f5f5f5;
    margin: 0;
    padding-bottom: 50px;
    text-align: center;
}

h1 {
    color: #ffa500; /* naranja dorado */
    margin: 20px 0;
    font-size: 2rem;
}

/* --- INPUTS --- */
#buscador, #nuevoRepertorio {
    margin: 10px auto;
    padding: 10px;
    width: 90%;
    max-width: 500px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ffa500;
    background: #111;
    color: #f5f5f5;
}

/* --- CANCIONES --- */
.cancion {
    background: #111;
    margin: 10px auto;
    padding: 15px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 10px rgba(255,165,0,0.3);
    transition: all 0.3s;
}

.cancion:hover {
    background: #222;
    transform: translateY(-2px);
}

.titulo {
    font-weight: bold;
    color: #ffa500;
    flex: 1;
    text-align: left;
}

/* --- LETRA --- */
.letra {
    white-space: pre-wrap;
    font-weight: bold;
    font-size: 1.1rem;
    line-height: 1.6;
    margin: 20px;
    text-align: center;
}

/* --- BOTONES --- */
button {
    background: #ffa500;
    color: #000;
    padding: 10px 20px;
    margin: 5px;
    font-size: 1rem;
    border-radius: 10px;
    border: none;
    transition: 0.3s;
    cursor: pointer;
}

button:hover {
    background: #ffbf00;
}

/* --- SELECTS --- */
select {
    padding: 8px;
    margin: 5px;
    border-radius: 8px;
    border: 1px solid #ffa500;
    background: #111;
    color: #f5f5f5;
}

/* --- NOTIFICACIONES --- */
#notificacion {
    display: none;
    padding: 10px;
    background: #ffbf00;
    color: #000;
    border-radius: 8px;
    margin: 10px auto;
    max-width: 400px;
    box-shadow: 0 3px 6px rgba(255,165,0,0.3);
}

/* --- MODAL --- */
.modal {
    display: none;
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
}

.modal-content {
    margin: 5% auto;
    background: #111;
    width: 90%;
    max-width: 800px;
    border-radius: 10px;
    position: relative;
    padding: 0;
}

.modal iframe {
    width: 100%;
    height: 400px;
    border-radius: 10px 10px 0 0;
    border: none;
}

.closeModal {
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 30px;
    color: #ffa500;
    cursor: pointer;
}

.closeModal:hover {
    color: #ffbf00;
}

/* --- RESPONSIVE --- */
@media (max-width: 600px){
    .letra { font-size: 1rem; }
    button, select, input { width: 80%; margin: 5px auto; }
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>ðŸ“– Cancionero Web</h1>
<div id="notificacion"></div>

<!-- --- PANTALLA PRINCIPAL --- -->
<div id="pantallaPrincipal">
    <input type="text" id="buscador" placeholder="ðŸ”Ž Buscar canciÃ³n...">
    <div id="lista"></div>

    <div>
        <button id="btnCrearRepertorio">âž• Crear Repertorio</button>
        <button id="btnVerRepertorios">ðŸ“‚ Ver Mis Repertorios</button>
    </div>
</div>

<!-- --- DETALLE CANCION --- -->
<div id="detalle" style="display:none;">
    <h2 id="tituloCancion"></h2>
    <div>
        <button class="tutorialBtn" data-instrumento="teclado">Teclado</button>
        <button class="tutorialBtn" data-instrumento="bateria">BaterÃ­a</button>
        <button class="tutorialBtn" data-instrumento="guitarra">Guitarra</button>
        <button class="tutorialBtn" data-instrumento="audio">Reproducir CanciÃ³n</button>
    </div>
    <div id="letraCancion" class="letra"></div>
    <button id="volver">â¬… Volver</button>
</div>

<!-- --- REPERTORIO --- -->
<div id="repertorio" style="display:none;">
    <h2>Repertorios</h2>
    <input type="text" id="nuevoRepertorio" placeholder="Nombre del nuevo repertorio">
    <button id="crearRepertorio">Crear</button>
    <select id="selectMisRepertorios"></select>
    <div id="repertorioLista"></div>
    <button id="volverRepertorio">â¬… Volver</button>
</div>

<!-- --- MODAL --- -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="closeModal" id="cerrarModal">&times;</span>
        <iframe id="iframeModal" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<script>
// --- VARIABLES ---
let canciones = [];
let repertorios = JSON.parse(localStorage.getItem("repertorios")) || {};
let repertorioActual = null;
let origenDetalle = "principal";

// --- FUNCIONES ---
function mostrarNotificacion(msg){
    const n=document.getElementById("notificacion");
    n.textContent=msg; n.style.display="block";
    setTimeout(()=> n.style.display="none",3000);
}

// Cargar canciones JSON
fetch("https://cdn.jsdelivr.net/gh/walterrubenhg/ESCOGIDOS/canciones.json")
.then(res=>res.json())
.then(data=>{ if(data && data.canciones) canciones=data.canciones; actualizarLista(); })
.catch(()=>{ canciones=[]; actualizarLista(); });

// Actualizar lista principal
function actualizarLista(){
    const texto=document.getElementById("buscador").value.toLowerCase();
    const listaDiv=document.getElementById("lista");
    listaDiv.innerHTML="";
    canciones.filter(c=>c.titulo.toLowerCase().includes(texto) || c.letra.toLowerCase().includes(texto))
    .forEach(c=>{
        const div=document.createElement("div"); div.className="cancion";

        const span=document.createElement("span"); span.textContent=c.titulo; span.className="titulo";
        span.onclick=()=>mostrarDetalle(c,"principal");
        div.appendChild(span);

        // Select para agregar a repertorio
        const selectRep=document.createElement("select");
        const defaultOpt=document.createElement("option"); defaultOpt.value=""; defaultOpt.textContent="+ Repertorio";
        selectRep.appendChild(defaultOpt);
        for(let r in repertorios){
            const opt=document.createElement("option"); opt.value=r; opt.textContent=r; selectRep.appendChild(opt);
        }
        selectRep.onchange=()=>{
            const r=selectRep.value; if(!r) return;
            if(!repertorios[r]) repertorios[r]=[];
            if(!repertorios[r].includes(c.titulo)) repertorios[r].push(c.titulo);
            localStorage.setItem("repertorios",JSON.stringify(repertorios));
            mostrarNotificacion(`"${c.titulo}" agregado a "${r}"`); selectRep.value="";
        };
        div.appendChild(selectRep);

        listaDiv.appendChild(div);
    });
}

// Mostrar detalle
function mostrarDetalle(c, origen){
    if(!c) return;
    origenDetalle=origen||"principal";
    document.getElementById("detalle").style.display="block";
    document.getElementById("pantallaPrincipal").style.display="none";
    document.getElementById("repertorio").style.display="none";

    document.getElementById("tituloCancion").textContent=c.titulo;
    document.getElementById("letraCancion").textContent=c.letra || "No hay letra disponible.";

    const iframe=document.getElementById("iframeModal");
    const modal=document.getElementById("modal");
    document.querySelectorAll(".tutorialBtn").forEach(btn=>{
        const instr=btn.dataset.instrumento;
        btn.onclick=()=>{ iframe.src=(instr==="audio"?c.audio:c.tutorial[instr]||""); modal.style.display="block"; };
    });
}

// Mostrar repertorio
function mostrarRepertorio(r){
    repertorioActual=r; origenDetalle="repertorio";
    document.getElementById("repertorio").style.display="block";
    document.getElementById("detalle").style.display="none";
    document.getElementById("pantallaPrincipal").style.display="none";

    const select=document.getElementById("selectMisRepertorios");
    select.innerHTML="";
    for(let rep in repertorios){
        const opt=document.createElement("option"); opt.value=rep; opt.textContent=rep;
        if(rep===r) opt.selected=true;
        select.appendChild(opt);
    }

    const lista=document.getElementById("repertorioLista");
    lista.innerHTML="";
    if(r && repertorios[r]){
        repertorios[r].forEach(titulo=>{
            const c=canciones.find(x=>x.titulo===titulo);
            if(c){
                const div=document.createElement("div"); div.className="cancion";
                const span=document.createElement("span"); span.textContent=c.titulo; span.className="titulo";
                span.onclick=()=>mostrarDetalle(c,"repertorio");
                div.appendChild(span);
                lista.appendChild(div);
            }
        });
    }
}

// --- EVENTOS ---
document.getElementById("buscador").addEventListener("input", actualizarLista);

document.getElementById("volver").onclick=()=>{
    if(origenDetalle==="repertorio" && repertorioActual) mostrarRepertorio(repertorioActual);
    else { document.getElementById("detalle").style.display="none"; document.getElementById("pantallaPrincipal").style.display="block"; }
};

document.getElementById("btnCrearRepertorio").onclick=()=>{
    document.getElementById("repertorio").style.display="block";
    document.getElementById("pantallaPrincipal").style.display="none";
};

document.getElementById("btnVerRepertorios").onclick=()=>{
    if(Object.keys(repertorios).length>0) mostrarRepertorio(Object.keys(repertorios)[0]);
    else mostrarNotificacion("No hay repertorios creados.");
};

document.getElementById("volverRepertorio").onclick=()=>{
    document.getElementById("repertorio").style.display="none";
    document.getElementById("pantallaPrincipal").style.display="block";
};

document.getElementById("crearRepertorio").onclick=()=>{
    const nombre=document.getElementById("nuevoRepertorio").value.trim();
    if(!nombre) return;
    if(!repertorios[nombre]) repertorios[nombre]=[];
    localStorage.setItem("repertorios",JSON.stringify(repertorios));
    mostrarNotificacion(`Repertorio "${nombre}" creado`);
    document.getElementById("nuevoRepertorio").value="";
    mostrarRepertorio(nombre);
};

document.getElementById("selectMisRepertorios").onchange=(e)=>mostrarRepertorio(e.target.value);

// Modal cerrar
document.getElementById("cerrarModal").onclick=()=>{ document.getElementById("modal").style.display="none"; document.getElementById("iframeModal").src=""; };
window.onclick=(e)=>{ if(e.target===document.getElementById("modal")){ document.getElementById("modal").style.display="none"; document.getElementById("iframeModal").src=""; } };
</script>
<script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registrado"))
        .catch(err => console.log("Error SW:", err));
    }
    </script>
    
</body>
</html>



