<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cancionero Web</title>
<style>
body {
    font-family: 'Arial', sans-serif;
    text-align: center;
    background: #111;
    color: #ffd700;
    margin: 0;
    padding-bottom: 50px;
}
h1 {
    color: #ffa500;
    font-size: 2.5rem;
    margin: 20px;
    text-shadow: 2px 2px #000;
}
#buscador {
    margin: 10px auto;
    padding: 10px;
    width: 90%;
    max-width: 500px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ffd700;
    background: #222;
    color: #ffd700;
}
.cancion {
    background: #1a1a1a;
    color: #ffd700;
    margin: 10px auto;
    padding: 15px 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 10px rgba(255, 165, 0, 0.3);
    border: 2px solid #ffd700;
    transition: transform 0.3s, background 0.3s;
}
.cancion:hover {
    background: #ffa500;
    color: #111;
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(255, 165, 0, 0.5);
}
.titulo { font-size:1.2rem; font-weight:bold; cursor:pointer; }
.letra { white-space: pre-wrap; font-weight:bold; font-size:1.1rem; line-height:1.6; text-align:center; margin-top:20px; }
#detalle, #repertorio { display: none; padding: 20px; }
button {
    margin-top: 10px;
    padding: 12px 25px;
    font-size: 1rem;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    background: #ffa500;
    color: #111;
    font-weight: bold;
    transition: 0.3s;
    box-shadow: 0 4px 10px rgba(255, 215, 0, 0.4);
}
button:hover {
    background: #ffd700;
    color: #111;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(255, 165, 0, 0.6);
}
.eliminarCancion {
    background: #ff4500;
}
.eliminarCancion:hover { background:#ff6347; }
#repertorioLista {
    background: #222;
    color: #ffd700;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 4px 10px rgba(255, 165, 0, 0.3);
}
.notificacion {
    background:#ff6f00;
    color:white;
    padding:10px;
    border-radius:8px;
    margin:10px auto;
    width:90%;
    max-width:400px;
    display:none;
    box-shadow:0 3px 6px rgba(0,0,0,0.1);
}
input, select { padding:8px 10px; border-radius:6px; border:1px solid #ffd700; background:#222; color:#ffd700; margin:5px;}
.modal { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.8);}
.modal-content { background-color:#1a1a1a; margin:10% auto; padding:0; border-radius:10px; width:90%; max-width:800px; position:relative;}
.modal iframe { width:100%; height:400px; border:none; border-radius:10px 10px 0 0; }
.close { color:white; position:absolute; top:10px; right:20px; font-size:30px; font-weight:bold; cursor:pointer; }
.close:hover { color:#ffa500; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>📖 Cancionero</h1>
<div class="notificacion" id="notificacion"></div>

<div id="pantallaPrincipal" style="display:block;">
    <button id="btnCrearRepertorio">Crear Repertorio</button>
    <button id="btnVerRepertorios">Ver Repertorios</button>
    <input type="text" id="buscador" placeholder="🔎 Buscar canción...">
    <div id="lista"></div>
</div>

<div id="detalle">
  <h2 id="tituloCancion"></h2>
  <div id="letraCancion" class="letra"></div>
  <div id="tutoriales">
    <button class="tutorialBtn" data-instrumento="teclado">Teclado</button>
    <button class="tutorialBtn" data-instrumento="bateria">Batería</button>
    <button class="tutorialBtn" data-instrumento="guitarra">Guitarra</button>
    <button class="tutorialBtn" data-instrumento="audio">Reproducir Canción</button>
  </div>
  <button id="volver">⬅ Volver</button>
</div>

<div id="repertorio">
  <h2>Mis Repertorios</h2>
  <div>
    <input type="text" id="nuevoRepertorio" placeholder="Nombre del nuevo repertorio">
    <button id="crearRepertorio">Crear</button>
  </div>
  <label for="selectMisRepertorios">Seleccionar Repertorio:</label>
  <select id="selectMisRepertorios"></select>
  <div id="repertorioLista"></div>
  <button id="volverRepertorio">⬅ Volver</button>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span id="cerrarModal" class="close">&times;</span>
        <iframe id="iframeModal" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<script>
let canciones=[], listaFiltrada=[];
let repertorios = JSON.parse(localStorage.getItem("repertorios")) || {};
let repertorioActual = null;
let origenDetalle = "principal";

const URL_JSON = "https://cdn.jsdelivr.net/gh/walterrubenhg/ESCOGIDOS/canciones.json?nocache=" + Date.now();
const pantallaPrincipal = document.getElementById("pantallaPrincipal");
const listaDiv = document.getElementById("lista");
const detalleDiv = document.getElementById("detalle");
const repertorioDiv = document.getElementById("repertorio");

function mostrarNotificacion(msg){
    const n = document.getElementById("notificacion");
    n.textContent = msg; n.style.display="block";
    setTimeout(()=>n.style.display="none",3000);
}

function guardarRepertorios(){ 
    localStorage.setItem("repertorios",JSON.stringify(repertorios)); 
    actualizarSelectMisRepertorios(); 
}

function actualizarSelectMisRepertorios(){
    const sel = document.getElementById("selectMisRepertorios");
    sel.innerHTML="";
    for(let r in repertorios){
        const opt = document.createElement("option");
        opt.value=r; opt.textContent=r;
        sel.appendChild(opt);
    }
}

function actualizarLista(){
    const texto=document.getElementById("buscador").value.toLowerCase();
    listaFiltrada = canciones.filter(c=>c.titulo.toLowerCase().includes(texto) || c.letra.toLowerCase().includes(texto));
    listaDiv.innerHTML="";
    listaFiltrada.forEach(c=>{
        const div = document.createElement("div");
        div.className="cancion";

        const tituloDiv = document.createElement("span");
        tituloDiv.textContent = c.titulo;
        tituloDiv.className="titulo";
        tituloDiv.onclick=()=>mostrarDetalle(c, "principal");
        div.appendChild(tituloDiv);

        const selectRep = document.createElement("select");
        const defaultOpt = document.createElement("option");
        defaultOpt.textContent = "+ Repertorio"; defaultOpt.value="";
        selectRep.appendChild(defaultOpt);
        for(let r in repertorios){
            const opt = document.createElement("option"); opt.value=r; opt.textContent=r; selectRep.appendChild(opt);
        }
        selectRep.onchange = ()=>{
            const repNombre = selectRep.value;
            if(!repNombre) return;
            if(repertorios[repNombre].includes(c.titulo)) return mostrarNotificacion("La canción ya está en ese repertorio");
            repertorios[repNombre].push(c.titulo);
            guardarRepertorios();
            mostrarNotificacion(`"${c.titulo}" agregado a ${repNombre}`);
            if(repertorioActual===repNombre) mostrarRepertorio();
            selectRep.value="";
        };
        div.appendChild(selectRep);
        listaDiv.appendChild(div);
    });
}

function mostrarDetalle(c, origen="principal", rep=null){
    origenDetalle = origen;
    if(rep) repertorioActual = rep;
    pantallaPrincipal.style.display = "none";
    repertorioDiv.style.display = "none";
    detalleDiv.style.display = "block";

    document.getElementById("tituloCancion").textContent = c.titulo;
    document.getElementById("letraCancion").textContent = c.letra;

    document.querySelectorAll(".tutorialBtn").forEach(btn => {
        btn.onclick = () => {
            let url = "";
            switch(btn.dataset.instrumento){
                case "teclado": url = c.tutorial?.teclado || ""; break;
                case "bateria": url = c.tutorial?.bateria || ""; break;
                case "guitarra": url = c.tutorial?.guitarra || ""; break;
                case "audio": url = c.audio || ""; break;
            }
            if(url){
                document.getElementById("iframeModal").src = url;
                document.getElementById("modal").style.display = "block";
            }
        };
    });
}

document.getElementById("volver").onclick = ()=>{
    detalleDiv.style.display="none";
    if(origenDetalle==="repertorio" && repertorioActual){
        mostrarRepertorio();
    } else {
        pantallaPrincipal.style.display="block";
    }
};

document.getElementById("cerrarModal").onclick = ()=>{
    document.getElementById("iframeModal").src="";
    document.getElementById("modal").style.display="none";
};

document.getElementById("btnCrearRepertorio").onclick = ()=>{
    pantallaPrincipal.style.display="none"; repertorioDiv.style.display="block";
    document.getElementById("nuevoRepertorio").value="";
};
document.getElementById("btnVerRepertorios").onclick = ()=>{
    repertorioActual = Object.keys(repertorios)[0] || null;
    mostrarRepertorio();
};

document.getElementById("crearRepertorio").onclick = ()=>{
    const nombre = document.getElementById("nuevoRepertorio").value.trim();
    if(!nombre) return;
    if(repertorios[nombre]) return mostrarNotificacion("Ya existe ese repertorio");
    repertorios[nombre]=[];
    guardarRepertorios();
    mostrarNotificacion(`Repertorio "${nombre}" creado`);
};

document.getElementById("selectMisRepertorios").onchange = ()=>{
    repertorioActual = document.getElementById("selectMisRepertorios").value;
    mostrarRepertorio();
};

document.getElementById("volverRepertorio").onclick = ()=>{
    repertorioDiv.style.display="none";
    pantallaPrincipal.style.display="block";
};

function mostrarRepertorio(){
    if(!repertorioActual) return;
    repertorioDiv.style.display="block"; pantallaPrincipal.style.display="none";
    const repListaDiv = document.getElementById("repertorioLista");
    repListaDiv.innerHTML="";
    document.getElementById("selectMisRepertorios").value = repertorioActual;

    repertorios[repertorioActual].forEach(titulo=>{
        const c = canciones.find(x=>x.titulo===titulo);
        if(!c) return;
        const div = document.createElement("div");
        div.className="cancion";

        const tituloDiv = document.createElement("span");
        tituloDiv.textContent = c.titulo;
        tituloDiv.className="titulo";
        tituloDiv.onclick = ()=> mostrarDetalle(c,"repertorio", repertorioActual);
        div.appendChild(tituloDiv);

        const btnEliminar = document.createElement("button");
        btnEliminar.textContent = "❌"; btnEliminar.className="eliminarCancion";
        btnEliminar.onclick = ()=>{
            repertorios[repertorioActual] = repertorios[repertorioActual].filter(x=>x!==c.titulo);
            guardarRepertorios();
            mostrarRepertorio();
        };
        div.appendChild(btnEliminar);
        repListaDiv.appendChild(div);
    });
}

// Cargar canciones desde JSON
fetch(URL_JSON).then(r=>r.json()).then(data=>{
    canciones = data.canciones || [];
    actualizarLista();
}).catch(()=>{ canciones=[]; actualizarLista(); });

document.getElementById("buscador").addEventListener("input", actualizarLista);
actualizarSelectMisRepertorios();
</script>
</body>
</html>


